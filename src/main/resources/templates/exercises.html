<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Exercises</title>
  <meta name="author" content="Adrian Villar">
  <meta name="description" content="Exercise list with a search form">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
</head>

<body>
  <form id="idSearchForm">
    <div class="rendered-form">
      <input type="text" class="form-control" name="exerciseName" id="exerciseName" placeholder="Exercise name" />
      <select class="form-control" name="musclegroup" id="musclegroup" onchange="loadSubMuscleGroups();loadTableData();">
        <option disabled selected value>Muscle group</option>
      </select>
      <select class="form-control" name="submusclegroup" id="submusclegroup" disabled onchange="loadTableData();">
        <option selected value>Sub muscle group</option>
      </select>
      <select class="form-control" name="loadtype" id="loadtype" onchange="loadTableData();">
        <option disabled selected value>Load type</option>
      </select>
      <label for="unilateral" class="formbuilder-checkbox-group-label">Unilateral</label>
      <input id="unilateral" value="true" type="checkbox"  onchange="loadTableData();"/>
      <a href="addExercise"><button type="button">New</button></a>
    </div>
  </form>

  <br />

  <table border="1" id="exercisesTable">
    <tr>
      <td>Name</td>
      <td>Description</td>
      <td>Muscle group</td>
      <td>Sub muscle group</td>
      <td>Load type</td>
      <td>Unilateral</td>
      <td>Actions</td>
    </tr>

    <tr>
      <td>Dumbbell flat press</td>
      <td></td>
      <td>Chest</td>
      <td>Middle</td>
      <td>Dumbbell</td>
      <td>No</td>
      <td>Edit - Delete</td>
    </tr>
  </table>

  <script>
    function loadMuscleGroups() {
      const select = $("#musclegroup");
      select.empty();
      select.append("<option selected value>Muscle group</option>");

      $.ajax({
        url: 'http://localhost:8080/api/muscleGroups',
        type: 'get',
        dataType: 'json',
        success: function (data) {
          $.each(data, function (i, item) {
            select.append('<option value="' + item.id + '">' + item.name + '</option>');
          });
        }
      });
    }
    function loadLoadTypes() {
      const select = $("#loadtype");
      select.empty();
      select.append("<option selected value>Load types</option>");

      $.ajax({
        url: 'http://localhost:8080/api/loadType',
        type: 'get',
        dataType: 'json',
        success: function (data) {
          $.each(data, function (i, item) {
            select.append('<option value="' + item.id + '">' + item.name + '</option>');
          });
        }
      });
    }
    function loadSubMuscleGroups() {
      const idMuscleGroup = $('#musclegroup option').filter(':selected').val();
      const select = $("#submusclegroup");
      select.empty();
      select.append("<option selected value>Sub muscle group</option>");
      select.prop("disabled", true);

      if (!idMuscleGroup) return;

      $.ajax({
        url: 'http://localhost:8080/api/muscleSubGroup',
        type: 'get',
        dataType: 'json',
        data: {'idMuscleGroup': idMuscleGroup},
        success: function (data) {
          $.each(data, function (i, item) {
            select.append('<option value="' + item.id + '">' + item.name + '</option>');
          });

          if (data) {
            select.prop("disabled", false);
          }
        }
      });
    }
    function loadTableData(){
      const table = $("#exercisesTable");

      $.ajax({
        url: 'http://localhost:8080/api/exercises',
        type: 'get',
        dataType: 'json',
        success: function (data) {
          $.each(data, function (i, item) {
            table.append("<tr>" +
                    "<td>"+item.name+"</td><td>"+item.description+"</td>" +
                    "<td>"+item.muscleGroups.name+"</td><td>"+item.muscleSubGroups.name+"</td>" +
                    "<td>"+item.loadTypeDto.name+"</td><td>"+item.unilateral.name+"</td></tr>");
          });
        }
      });
    }

    $(document).ready(function () {
      loadMuscleGroups();
      loadLoadTypes();
    });
  </script>
</body>

</html>